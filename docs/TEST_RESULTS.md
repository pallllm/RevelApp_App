# RevelApp Customer Portal - テスト結果レポート

**テスト実施日**: 2026年1月19日
**テスト環境**: 開発環境 (localhost:3000)
**テスト実施者**: Claude

---

## 1. テスト概要

本番デプロイ前の動作確認テストを実施。APIエンドポイントの動作確認およびビルドテストを行った。

---

## 2. API動作確認テスト

### 2.1 認証

| テスト項目 | エンドポイント | 結果 | 備考 |
|-----------|---------------|------|------|
| 開発トークン認証 | 全API | OK | `Bearer dev-token` で認証成功 |

### 2.2 施設情報API

| テスト項目 | エンドポイント | 結果 | レスポンス例 |
|-----------|---------------|------|-------------|
| 施設情報取得 | GET /api/facilities | OK | `{ name: "テスト事業所", planType: "FLEXIBLE" }` |
| 施設統計取得 | GET /api/facilities/stats | OK | 利用者数、継続月数、工賃フェーズ取得成功 |

### 2.3 工賃関連API

| テスト項目 | エンドポイント | 結果 | レスポンス例 |
|-----------|---------------|------|-------------|
| 工賃フェーズ取得 | GET /api/facilities/stats | OK | `{ phaseName: "0〜3ヶ月", level1Wage: 50, level2Wage: 60, level3Wage: 70, level4Wage: 80 }` |
| 工賃履歴取得 | GET /api/wages/history | OK | 6件の履歴データ取得（totalCount: 12） |

**工賃フェーズ検証結果**

| フェーズ | 期待値 Lv1-4 | 実測値 Lv1-4 | 結果 |
|---------|-------------|-------------|------|
| 0〜3ヶ月 | 50/60/70/80 | 50/60/70/80 | OK |
| 4〜9ヶ月 | 60/70/80/90 | 60/70/80/90 | OK |
| 9ヶ月以上 | 70/80/90/100 | 70/80/90/100 | OK |

### 2.4 カレンダーAPI

| テスト項目 | エンドポイント | 結果 | レスポンス例 |
|-----------|---------------|------|-------------|
| 月間イベント取得 | GET /api/calendar-events?year=2026&month=1 | OK | 5件のイベント取得 |

**取得イベント一覧（2026年1月）**

| 日付 | イベント名 |
|-----|----------|
| 11日 | 前月分報酬額決定日 |
| 15日 | 来月分の変更申請の期限日 |
| 23日 | 翌月分利用料決済日 |
| 25日 | 前月分工賃振り込み日 |
| 26日 | 契約施設様向けAMA@zoom |

### 2.5 通知API

| テスト項目 | エンドポイント | 結果 | レスポンス例 |
|-----------|---------------|------|-------------|
| 通知一覧取得 | GET /api/notifications | OK | 5件の通知取得 |

---

## 3. ビルドテスト

| テスト項目 | コマンド | 結果 | 備考 |
|-----------|---------|------|------|
| 本番ビルド | `npm run build` | OK | エラーなし、全ページビルド成功 |

**ビルド出力（主要ページ）**

| ページ | サイズ | タイプ |
|-------|-------|-------|
| /app (ホーム) | 7.5 kB | Static |
| /app/contract | 6.77 kB | Static |
| /app/games | 3.49 kB | Static |
| /app/health-graph | 122 kB | Static |
| /app/members | 5.8 kB | Static |
| /app/requests | 13 kB | Static |
| /app/rewards | 8.15 kB | Static |
| /app/support | 3.29 kB | Static |
| /login | 2.64 kB | Static |

---

## 4. データベース検証

### 4.1 工賃フェーズマスタ (WagePhase)

データベースの値が正しく設定されていることを確認。

```sql
SELECT phaseName, minMonths, maxMonths, level1Wage, level2Wage, level3Wage, level4Wage
FROM wage_phases;
```

| phaseName | minMonths | maxMonths | Lv1 | Lv2 | Lv3 | Lv4 |
|-----------|-----------|-----------|-----|-----|-----|-----|
| 0〜3ヶ月 | 0 | 3 | 50 | 60 | 70 | 80 |
| 4〜9ヶ月 | 4 | 9 | 60 | 70 | 80 | 90 |
| 9ヶ月以上 | 9 | NULL | 70 | 80 | 90 | 100 |

---

## 5. 修正履歴

本テスト実施に伴い、以下の修正を行った。

| 修正項目 | 修正内容 |
|---------|---------|
| カレンダーAPI認証 | `app/app/page.tsx`でカレンダーイベント取得時に認証トークンが送信されていない問題を修正 |
| 工賃フェーズDB | データベースの工賃フェーズ値を正しい値（50/60/70/80円〜）に修正 |
| シードデータ | `prisma/seed.ts`のフェーズ名を「4〜9ヶ月」に統一 |
| 設計書 | REQUIREMENTS.md, SYSTEM_DESIGN.md, DATABASE_DESIGN.mdの工賃フェーズ記載を統一 |
| ホーム画面 | カレンダーの「請求」「メンテ」表示を削除、「今後の機能追加エリア」を削除 |

---

## 6. 未テスト項目

以下の項目は本テストでは未実施。

| 項目 | 理由 |
|-----|------|
| ログイン機能 | ブラウザでの手動テストが必要 |
| 変更申請フォーム | フォーム送信の手動テストが必要 |
| PDF出力 | ブラウザでのダウンロードテストが必要 |
| 工賃計算実行 | 運営管理ポータルからの実行が必要 |

---

## 7. 結論

APIエンドポイントおよびビルドテストはすべて正常に完了。本番デプロイの準備が整っている。

ブラウザでの手動テスト（ログイン、フォーム送信、PDF出力等）は別途実施を推奨。
